name: VM Modifications
on:
  push:
    branches:
      - main
  pull_request:
    branches:
      - main
  workflow_dispatch:

permissions:
  contents: write

jobs:
  HBSD_16CURRENT_UFS_AMD64_MODIFIED:
    runs-on: ubuntu-latest
    name: 16CURRENT_UFS_AMD64
    steps:
    - uses: actions/checkout@v4
    - name: Build image
      id: build
      uses: vmactions/freebsd-vm@v1
      with:
        release: "15.0"
        usesh: true
        run: |
          pkg install -y curl go git
          go version
          cd ${GITHUB_WORKSPACE}
          go mod tidy
          go run ./... -r 16-CURRENT
    - name: Release image
      uses: ncipollo/release-action@v1
      with:
        tag: 16CURRENT_UFS_AMD64_MODIFIED
        name: "16CURRENT_UFS_AMD64_MODIFIED"
        artifacts: |
          hardenedbsd-vm.raw.xz
        allowUpdates: true
        generateReleaseNotes: false

  HBSD_15STABLE_UFS_AMD64_MODIFIED:
    runs-on: ubuntu-latest
    name: 15STABLE_UFS_AMD64
    steps:
    - uses: actions/checkout@v4
    - name: Build image
      id: build
      uses: vmactions/freebsd-vm@v1
      with:
        release: "15.0"
        usesh: true
        run: |
          pkg install -y curl go git
          go version
          cd ${GITHUB_WORKSPACE}
          go mod tidy
          go run ./... -r 15-STABLE
    - name: Release image
      uses: ncipollo/release-action@v1
      with:
        tag: 15STABLE_UFS_AMD64_MODIFIED
        name: "15STABLE_UFS_AMD64_MODIFIED"
        artifacts: |
          hardenedbsd-vm.raw.xz
        allowUpdates: true
        generateReleaseNotes: false
